<h2 id="-">Введение</h2>
<p><strong>Node.js</strong> (Node)</p>
<blockquote>
<p>Для начала работы нам необходимы 3 вещи:</p>
<p>Node.js. Node не является сервером, это платформа для движка V8 (V8 - транслятор javascript в машинный код) предоставляющая доступ к низкоуровневым устройствам ввода-вывода для javascript через свой API. <sup><a href="https://ru.wikipedia.org/wiki/Node.js" title="Node.js">1</a></sup> <sup><a href="http://nodejs.org/" title="Node.js">2</a></sup></p>
</blockquote>
<p><strong>npm</strong> - Менеджер сторонних пакетов. Входит в дистрибутив Node</p>
<blockquote>
<p>Главной частью экосистемы Node являются пакеты (javascript приложения со своим API). Пакеты могут зависеть друг от друга и задача npm не только установить пакеты, но и решить их рекурсивные зависимости и коллизии</p>
<p>Любой желающий может создать и поделиться своим node-пакетом через npm, что делает экосистему всё больше и больше. На сегодняшний момент уже больше 104 тыс. доступных пакетов. <sup><a href="http://nodegeek.net/2014/01/node-js-ecosystem/" title="Node.js ecosystem">3</a></sup> <sup><a href="https://www.npmjs.org/" title="Node Packaged Modules">4</a></sup></p>
</blockquote>
<p><strong>Полюбить командную строку (консоль)</strong></p>
<blockquote>
<p>Node.js изначально была частью экосистем *nix где большая часть приложений и утилит разработаны для работы в командной строке (CLI - Command Line Interface), поэтому для комфортной работы нужно полюбить командную строку (консоль) <sup><a href="https://ru.wikipedia.org/wiki/Интерфейс_командной_строки" title="Интерфейс командной строки">4.1</a></sup></p>
<p>При должном уровне сноровки работа в консоли может быть намного производительнее, чем в файловом менеджере, особенно в терминале *nix с поддержкой автодополнения, истории ввода, копирования и вставки. Для Windows можно использовать эмуляторы терминала Cmder<sup><a href="http://bliker.github.io/cmder/" title="cmder">4.2</a></sup> или PowerShell<sup><a href="https://ru.wikipedia.org/wiki/Windows_PowerShell" title="Windows PowerShell">4.3</a></sup></p>
<p>Консоль позволяет удобно отслеживать возвращаемые оповещения, инструкции и ошибки не отвлекаясь от рабочего окна и не потеряв ничего важного</p>
</blockquote>
<p><img src="/home/dsh/Projects/markup-blueprint/content/images/unix-way.png" alt="Unix-way"></p>
<h2 id="-">Инициализация пакета (проекта)</h2>
<blockquote>
<p>Для Node любой проект является пакетом поэтому начало работы идёт с его описания в файле <code style="font-family: InconsolataCyr;">package.json</code>. Его шаблон можно создать вручую или ответив на несколько вопросов запустив команду:</p>
</blockquote>
<p><code style="font-family: InconsolataCyr;">npm init</code></p>
<p><img src="/home/dsh/Projects/markup-blueprint/content/images/npm-init.png" alt="Unix-way"></p>
<blockquote>
<p>Название пакета, версия, описание, ссылка на репозиторий, авторство и лицензия</p>
</blockquote>
<p><img src="/home/dsh/Projects/markup-blueprint/content/images/package.png" alt="Unix-way"></p>
<blockquote>
<p>Если в текущем каталоге были ранее установленные пакеты, то они пропишутся в секцию <code style="font-family: InconsolataCyr;">dependencies</code> файла package.json <sup><a href="https://www.npmjs.org/doc/cli/npm-init.html" title="Interactively create a package.json file">5</a></sup> <sup><a href="https://www.npmjs.org/doc/files/package.json.html" title="Specifics of npm's package.json handling">6</a></sup> <sup><a href="http://browsenpm.org/package.json" title="package.json structure">7</a></sup></p>
</blockquote>
<h2 id="-node-js">Пакеты Node.js</h2>
<h3 id="-">Установка пакетов вручную</h3>
<p><code style="font-family: InconsolataCyr;">npm install &lt;имя_пакета&gt;</code> или сокращенно <code style="font-family: InconsolataCyr;">npm i &lt;имя_пакета&gt;</code></p>
<h5 id="-">Флаги и ключи:</h5>
<ul>
<li><code style="font-family: InconsolataCyr;">-g</code> -  флаг устанавки пакета глобально (для вызова из командной строки)</li>
<li><code style="font-family: InconsolataCyr;">--save</code> - ключ сохранения имени пакета в секцию dependencies файла package.json</li>
<li><code style="font-family: InconsolataCyr;">--save-dev</code> - ключ сохранения имени пакета в секцию devDependencies файла package.json</li>
</ul>
<blockquote>
<p>В секцию devDependencies прописываются пакеты участвующие при разработке проекта (тестирование, линтинг, минимизирование, компиляция). В dependencies - пакеты непосредственно подключаемые при работе пакета <sup><a href="http://howtonode.org/managing-module-dependencies" title="Managing module dependencies">8</a></sup></p>
<p>По-умолчанию пакет устанавливается в папку node_modules разрабатываемого пакета. Если у устанавливаемого пакета есть свои зависимости они тоже устанавливаются в папку node_modules в корне самого пакета (рекурсивная зависимость)</p>
<p><strong>Важно!</strong>
Некоторые пакеты используются в командной строке (CLI: Command-line interface) в любой директории, для этого они должны быть установлены глобально (с флагом -g) и путь их установки должен быть прописан в переменной окружения PATH</p>
</blockquote>
<h3 id="-">Автоматическая установка пакетов</h3>
<blockquote>
<p>Если у нас уже есть пакет с прописанными зависимостями в файле package.json</p>
</blockquote>
<p>При наличии файла package.json с прописанными пакетами в каталоге проекта. Версия для разработки:</p>
<p><code style="font-family: InconsolataCyr;">npm install</code> или сокращенно <code style="font-family: InconsolataCyr;">npm i</code> при наличии прописанных пакетов в секции dependencies и в devDependencies файла package.json</p>
<p>При установке пакета на продакшн командой <code style="font-family: InconsolataCyr;">npm install --production</code> или сокращенно <code style="font-family: InconsolataCyr;">npm i --production</code> пакеты из секции devDependencies установлены не будут <sup><a href="http://howtonode.org/managing-module-dependencies" title="Managing module dependencies">8</a></sup></p>
<h2 id="-">Пакеты для сборки</h2>
<h3 id="-gulp-js-gulp-task-runner-"><strong><em>Gulp.js</em></strong> (Gulp) - потоковый менеджер задач (task runner) для сборки проектов</h3>
<p>Глобальная установка CLI-версии Gulp:</p>
<p><code style="font-family: InconsolataCyr;">sudo npm install -g gulp</code></p>
<p>Установка локального менеджера задач:</p>
<p><code style="font-family: InconsolataCyr;">npm install gulp --save-dev</code></p>
<blockquote>
<p>Gulp - Node пакет работающий в командной строке (CLI) и предоставляющий интерфейс для поочередного запуска других пакетов, работы с файлами и каталогами через маски</p>
</blockquote>
<h4 id="gulpfile-js">Gulpfile.js</h4>
<blockquote>
<p>Gulpfile - javascript файл описывающий подключение пакетов, задачи gulp и при необходимости сервисные функции. <sup><a href="https://www.npmjs.org/package/gulp" title="The streaming build system">9</a></sup></p>
<p>Gulpfile создаётся в корне проекта</p>
</blockquote>
<p><code style="font-family: InconsolataCyr;">touch Gulpfile.js</code></p>
<p><img src="/home/dsh/Projects/markup-blueprint/content/images/touch-gulpfile.png" alt="Unix-way"></p>
<blockquote>
<p>При запуске Gulp без параметов при пустом Gulpfile выдаётся сообщение об отсутствии задачи с именем <strong>default</strong>, которая выполняется по-умолчанию</p>
</blockquote>
<p><img src="/home/dsh/Projects/markup-blueprint/content/images/gulpfile-blank.png" alt="Unix-way"></p>
<blockquote>
<p>Откроем на редактирование Gulpfile.js. Весь javascript будем писать в Strict-режиме</p>
<p>Подключим пакет Gulp и создадим задачу по-умолчанию:</p>
</blockquote>
<pre class="editor-colors lang-javascript"><div class="line"><span class="source js"><span class="string quoted single js"><span class="punctuation definition string begin js"><span>'</span></span><span>use&nbsp;strict</span><span class="punctuation definition string end js"><span>'</span></span></span><span class="punctuation terminator statement js"><span>;</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;</span></span></div><div class="line"><span class="source js"><span class="storage modifier js"><span>var</span></span><span>&nbsp;gulp&nbsp;</span><span class="keyword operator js"><span>=</span></span><span>&nbsp;</span><span class="support function js"><span>require</span></span><span class="meta brace round js"><span>(</span></span><span class="string quoted single js"><span class="punctuation definition string begin js"><span>'</span></span><span>gulp</span><span class="punctuation definition string end js"><span>'</span></span></span><span class="meta brace round js"><span>)</span></span><span class="punctuation terminator statement js"><span>;</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;</span></span></div><div class="line"><span class="source js"><span>gulp</span><span class="meta delimiter method period js"><span>.</span></span><span>task</span><span class="meta brace round js"><span>(</span></span><span class="string quoted single js"><span class="punctuation definition string begin js"><span>'</span></span><span>default</span><span class="punctuation definition string end js"><span>'</span></span></span><span class="meta brace round js"><span>)</span></span><span class="punctuation terminator statement js"><span>;</span></span></span></div></pre>
<blockquote>
<p>Удобнее для работы и отладки не писать функционал в задачу по-умолчанию, а создать отдельную задачу на каждый сценарий</p>
</blockquote>
<h4 id="-less-css">Компиляция Less в Css</h4>
<p><code style="font-family: InconsolataCyr;">npm install gulp-less --save-dev</code></p>
<p><code style="font-family: InconsolataCyr;">npm install gulp-rename --save-dev</code></p>
<pre class="editor-colors lang-javascript"><div class="line"><span class="source js"><span class="storage modifier js"><span>var</span></span><span>&nbsp;gulp&nbsp;</span><span class="keyword operator js"><span>=</span></span><span>&nbsp;</span><span class="support function js"><span>require</span></span><span class="meta brace round js"><span>(</span></span><span class="string quoted single js"><span class="punctuation definition string begin js"><span>'</span></span><span>gulp</span><span class="punctuation definition string end js"><span>'</span></span></span><span class="meta brace round js"><span>)</span></span><span class="meta delimiter object comma js"><span>,</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;rename&nbsp;</span><span class="keyword operator js"><span>=</span></span><span>&nbsp;</span><span class="support function js"><span>require</span></span><span class="meta brace round js"><span>(</span></span><span class="string quoted single js"><span class="punctuation definition string begin js"><span>'</span></span><span>gulp-rename</span><span class="punctuation definition string end js"><span>'</span></span></span><span class="meta brace round js"><span>)</span></span><span class="meta delimiter object comma js"><span>,</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;less&nbsp;</span><span class="keyword operator js"><span>=</span></span><span>&nbsp;</span><span class="support function js"><span>require</span></span><span class="meta brace round js"><span>(</span></span><span class="string quoted single js"><span class="punctuation definition string begin js"><span>'</span></span><span>gulp-less</span><span class="punctuation definition string end js"><span>'</span></span></span><span class="meta brace round js"><span>)</span></span><span class="punctuation terminator statement js"><span>;</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;</span></span></div><div class="line"><span class="source js"><span>gulp</span><span class="meta delimiter method period js"><span>.</span></span><span>task</span><span class="meta brace round js"><span>(</span></span><span class="string quoted single js"><span class="punctuation definition string begin js"><span>'</span></span><span>buildcss</span><span class="punctuation definition string end js"><span>'</span></span></span><span class="meta delimiter object comma js"><span>,</span></span><span>&nbsp;</span><span class="meta function js"><span class="storage type function js"><span>function</span></span><span class="punctuation definition parameters begin js"><span>(</span></span><span class="punctuation definition parameters end js"><span>)</span></span></span><span>&nbsp;</span><span class="meta brace curly js"><span>{</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;</span><span class="keyword control js"><span>return</span></span><span>&nbsp;gulp</span><span class="meta delimiter method period js"><span>.</span></span><span class="support constant dom js"><span>src</span></span><span class="meta brace round js"><span>(</span></span><span class="string quoted single js"><span class="punctuation definition string begin js"><span>'</span></span><span>./styles.less</span><span class="punctuation definition string end js"><span>'</span></span></span><span class="meta brace round js"><span>)</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta delimiter method period js"><span>.</span></span><span>pipe</span><span class="meta brace round js"><span>(</span></span><span>less</span><span class="meta brace round js"><span>(</span><span>)</span><span>)</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta delimiter method period js"><span>.</span></span><span>pipe</span><span class="meta brace round js"><span>(</span></span><span>rename</span><span class="meta brace round js"><span>(</span></span><span class="string quoted single js"><span class="punctuation definition string begin js"><span>'</span></span><span>styles.css</span><span class="punctuation definition string end js"><span>'</span></span></span><span class="meta brace round js"><span>)</span><span>)</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta delimiter method period js"><span>.</span></span><span>pipe</span><span class="meta brace round js"><span>(</span></span><span>gulp</span><span class="meta delimiter method period js"><span>.</span></span><span>dest</span><span class="meta brace round js"><span>(</span></span><span class="string quoted single js"><span class="punctuation definition string begin js"><span>'</span></span><span>./</span><span class="punctuation definition string end js"><span>'</span></span></span><span class="meta brace round js"><span>)</span><span>)</span></span><span class="punctuation terminator statement js"><span>;</span></span></span></div><div class="line"><span class="source js"><span class="meta brace curly js"><span>}</span></span><span class="meta brace round js"><span>)</span></span><span class="punctuation terminator statement js"><span>;</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;</span></span></div><div class="line"><span class="source js"><span>gulp</span><span class="meta delimiter method period js"><span>.</span></span><span>task</span><span class="meta brace round js"><span>(</span></span><span class="string quoted single js"><span class="punctuation definition string begin js"><span>'</span></span><span>default</span><span class="punctuation definition string end js"><span>'</span></span></span><span class="meta delimiter object comma js"><span>,</span></span><span>&nbsp;</span><span class="meta brace square js"><span>[</span></span><span class="string quoted single js"><span class="punctuation definition string begin js"><span>'</span></span><span>buildcss</span><span class="punctuation definition string end js"><span>'</span></span></span><span class="meta brace square js"><span>]</span></span><span class="meta brace round js"><span>)</span></span><span class="punctuation terminator statement js"><span>;</span></span></span></div></pre>
<blockquote>
<p>Функция gulp.src образует поток (stream) который направляется в трубу (pipe). Каждый сегмент трубы вызывает пакет-обработчик и снова образует поток. Таким образом на один поток можно ставить несколько обработчиков</p>
<p>Обработчик gulp.dest записывает текущий поток в файл в указанную папку. Имя файла при этом сохраняется исходное и чтобы его изменить применяется пакет gulp-rename <sup><a href="https://github.com/hparra/gulp-rename" title="gulp-rename">10</a></sup></p>
<p>gulp.dest не завершает поток, а вставляется в секцию трубы</p>
</blockquote>
<h4 id="autoprefixer-csso">Autoprefixer, CSSO</h4>
<blockquote>
<p>Для демонстрации работы потоков добавим два пакета для обработки CSS</p>
</blockquote>
<p><code style="font-family: InconsolataCyr;">npm install gulp-autoprefixer --save-dev</code></p>
<blockquote>
<p><strong>autoprefixer</strong> пакет для автоматической подстановки вендорных префиксов к свойствам. Данные берутся из базы сайта <a href="http://caniuse.com/">http://caniuse.com/</a></p>
</blockquote>
<p><code style="font-family: InconsolataCyr;">npm install gulp-csso --save-dev</code></p>
<blockquote>
<p><strong>CSSO</strong> (CSS Optimizer) gulp-версия пакета оптимизации и минификации CSS файла. CSSO выполняет минимизацию как без изменения структуры, так и структурную оптимизацию <sup><a href="http://ru.bem.info/tools/optimizers/csso/" title="CSS Optimizer">10.1</a></sup></p>
<p>Чтобы не объявлять каждый gulp-пакет в отдельную переменную используем пакет gulp-load-plugins <sup><a href="https://github.com/jackfranklin/gulp-load-plugins" title="gulp-load-plugins">11</a></sup>, который автоматический загружает пакеты в объект при обращении. Установка: <code style="font-family: InconsolataCyr;">npm install gulp-load-plugins --save-dev</code></p>
<p>В итоге задача <strong>lesscss</strong> будет выглядеть так:</p>
</blockquote>
<pre class="editor-colors lang-javascript"><div class="line"><span class="source js"><span class="storage modifier js"><span>var</span></span><span>&nbsp;gulp&nbsp;</span><span class="keyword operator js"><span>=</span></span><span>&nbsp;</span><span class="support function js"><span>require</span></span><span class="meta brace round js"><span>(</span></span><span class="string quoted single js"><span class="punctuation definition string begin js"><span>'</span></span><span>gulp</span><span class="punctuation definition string end js"><span>'</span></span></span><span class="meta brace round js"><span>)</span></span><span class="meta delimiter object comma js"><span>,</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;plugins&nbsp;</span><span class="keyword operator js"><span>=</span></span><span>&nbsp;</span><span class="support function js"><span>require</span></span><span class="meta brace round js"><span>(</span></span><span class="string quoted single js"><span class="punctuation definition string begin js"><span>'</span></span><span>gulp-load-plugins</span><span class="punctuation definition string end js"><span>'</span></span></span><span class="meta brace round js"><span>)</span><span>(</span><span>)</span></span><span class="punctuation terminator statement js"><span>;</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;</span></span></div><div class="line"><span class="source js"><span>gulp</span><span class="meta delimiter method period js"><span>.</span></span><span>task</span><span class="meta brace round js"><span>(</span></span><span class="string quoted single js"><span class="punctuation definition string begin js"><span>'</span></span><span>buildcss</span><span class="punctuation definition string end js"><span>'</span></span></span><span class="meta delimiter object comma js"><span>,</span></span><span>&nbsp;</span><span class="meta function js"><span class="storage type function js"><span>function</span></span><span class="punctuation definition parameters begin js"><span>(</span></span><span class="punctuation definition parameters end js"><span>)</span></span></span><span>&nbsp;</span><span class="meta brace curly js"><span>{</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;</span><span class="keyword control js"><span>return</span></span><span>&nbsp;gulp</span><span class="meta delimiter method period js"><span>.</span></span><span class="support constant dom js"><span>src</span></span><span class="meta brace round js"><span>(</span></span><span class="string quoted single js"><span class="punctuation definition string begin js"><span>'</span></span><span>./styles.less</span><span class="punctuation definition string end js"><span>'</span></span></span><span class="meta brace round js"><span>)</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta delimiter method period js"><span>.</span></span><span>pipe</span><span class="meta brace round js"><span>(</span></span><span>plugins</span><span class="meta delimiter method period js"><span>.</span></span><span>less</span><span class="meta brace round js"><span>(</span><span>)</span><span>)</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta delimiter method period js"><span>.</span></span><span>pipe</span><span class="meta brace round js"><span>(</span></span><span>plugins</span><span class="meta delimiter method period js"><span>.</span></span><span>autoprefixer</span><span class="meta brace round js"><span>(</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta brace square js"><span>[</span></span><span class="string quoted single js"><span class="punctuation definition string begin js"><span>'</span></span><span>last&nbsp;3&nbsp;versions</span><span class="punctuation definition string end js"><span>'</span></span></span><span class="meta delimiter object comma js"><span>,</span></span><span>&nbsp;</span><span class="string quoted single js"><span class="punctuation definition string begin js"><span>'</span></span><span>ie&nbsp;9</span><span class="punctuation definition string end js"><span>'</span></span></span><span class="meta delimiter object comma js"><span>,</span></span><span>&nbsp;</span><span class="string quoted single js"><span class="punctuation definition string begin js"><span>'</span></span><span>ie&nbsp;10</span><span class="punctuation definition string end js"><span>'</span></span></span><span class="meta delimiter object comma js"><span>,</span></span><span>&nbsp;</span><span class="string quoted single js"><span class="punctuation definition string begin js"><span>'</span></span><span>opera&nbsp;12</span><span class="punctuation definition string end js"><span>'</span></span></span><span class="meta brace square js"><span>]</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta brace round js"><span>)</span><span>)</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta delimiter method period js"><span>.</span></span><span>pipe</span><span class="meta brace round js"><span>(</span></span><span>plugins</span><span class="meta delimiter method period js"><span>.</span></span><span>csso</span><span class="meta brace round js"><span>(</span><span>)</span><span>)</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta delimiter method period js"><span>.</span></span><span>pipe</span><span class="meta brace round js"><span>(</span></span><span>plugins</span><span class="meta delimiter method period js"><span>.</span></span><span>rename</span><span class="meta brace round js"><span>(</span></span><span class="string quoted single js"><span class="punctuation definition string begin js"><span>'</span></span><span>styles.min.css</span><span class="punctuation definition string end js"><span>'</span></span></span><span class="meta brace round js"><span>)</span><span>)</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta delimiter method period js"><span>.</span></span><span>pipe</span><span class="meta brace round js"><span>(</span></span><span>gulp</span><span class="meta delimiter method period js"><span>.</span></span><span>dest</span><span class="meta brace round js"><span>(</span></span><span class="string quoted single js"><span class="punctuation definition string begin js"><span>'</span></span><span>./app/styles</span><span class="punctuation definition string end js"><span>'</span></span></span><span class="meta brace round js"><span>)</span><span>)</span></span><span class="punctuation terminator statement js"><span>;</span></span></span></div><div class="line"><span class="source js"><span class="meta brace curly js"><span>}</span></span><span class="meta brace round js"><span>)</span></span><span class="punctuation terminator statement js"><span>;</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;</span></span></div><div class="line"><span class="source js"><span>gulp</span><span class="meta delimiter method period js"><span>.</span></span><span>task</span><span class="meta brace round js"><span>(</span></span><span class="string quoted single js"><span class="punctuation definition string begin js"><span>'</span></span><span>default</span><span class="punctuation definition string end js"><span>'</span></span></span><span class="meta delimiter object comma js"><span>,</span></span><span>&nbsp;</span><span class="meta brace square js"><span>[</span></span><span class="string quoted single js"><span class="punctuation definition string begin js"><span>'</span></span><span>buildcss</span><span class="punctuation definition string end js"><span>'</span></span></span><span class="meta brace square js"><span>]</span></span><span class="meta brace round js"><span>)</span></span><span class="punctuation terminator statement js"><span>;</span></span></span></div></pre>
<blockquote>
<p>Запуск из командной строки может выполняться без параметров <code style="font-family: InconsolataCyr;">gulp</code>, при этом выполняется задача default или с именем задачи в параметрах <code style="font-family: InconsolataCyr;">gulp lesscss</code>, тогда выполняется задача lesscss. Последнее может быть удобно при отладке определённой задачи без выполнения остальных</p>
</blockquote>
<h4 id="-">Шаблоны имён файлов</h4>
<blockquote>
<p>gulp.src может принимать не только один файл, но и массив имён и массив шаблонов <sup><a href="https://github.com/isaacs/minimatch" title="A minimal matching utility">12</a></sup></p>
</blockquote>
<ul>
<li><code style="font-family: InconsolataCyr;">'*.js'</code> - любое имя файла</li>
<li><code style="font-family: InconsolataCyr;">'filename.*'</code> - любое расширение</li>
<li><code style="font-family: InconsolataCyr;">'/*/filename.js'</code> - любой каталог</li>
<li><code style="font-family: InconsolataCyr;">'/**/*.js'</code> - любой вложенный каталог</li>
<li><code style="font-family: InconsolataCyr;">'/{foo,bar}/*.js'</code> - каталог foo или bar</li>
<li><code style="font-family: InconsolataCyr;">'/fonts/*.{ttf,svg,woff}'</code> - расширение файла ttf или svg или woff</li>
<li><code style="font-family: InconsolataCyr;">['filename.*', '!*.css']</code> - любое расширение кроме css</li>
</ul>
<blockquote>
<p>На практике зачастую каждая задача манипулирует со своим типом файлов (css, js или изображениями), но иногда приходится делать выборку, например, между исходным и минимизированным css файлом</p>
</blockquote>
<h4 id="watch-">Watch. Мониторинг изменений в файлах</h4>
<blockquote>
<p>Встроенная функция gulp.watch для отслеживания изменений в файлах проекта и запуска заданных задач <sup><a href="http://zencoder.ru/gulp-watch/" title="gulp-watch">13</a></sup></p>
</blockquote>
<pre class="editor-colors lang-javascript"><div class="line"><span class="source js"><span>gulp</span><span class="meta delimiter method period js"><span>.</span></span><span>task</span><span class="meta brace round js"><span>(</span></span><span class="string quoted single js"><span class="punctuation definition string begin js"><span>'</span></span><span>watch</span><span class="punctuation definition string end js"><span>'</span></span></span><span class="meta delimiter object comma js"><span>,</span></span><span>&nbsp;</span><span class="meta function js"><span class="storage type function js"><span>function</span></span><span class="punctuation definition parameters begin js"><span>(</span></span><span class="punctuation definition parameters end js"><span>)</span></span></span><span>&nbsp;</span><span class="meta brace curly js"><span>{</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;gulp</span><span class="meta delimiter method period js"><span>.</span></span><span class="support function js"><span>watch</span></span><span class="meta brace round js"><span>(</span></span><span class="meta brace square js"><span>[</span></span><span class="string quoted single js"><span class="punctuation definition string begin js"><span>'</span></span><span>*.less</span><span class="punctuation definition string end js"><span>'</span></span></span><span class="meta brace square js"><span>]</span></span><span class="meta delimiter object comma js"><span>,</span></span><span>&nbsp;</span><span class="meta brace square js"><span>[</span></span><span class="string quoted single js"><span class="punctuation definition string begin js"><span>'</span></span><span>lesscss</span><span class="punctuation definition string end js"><span>'</span></span></span><span class="meta brace square js"><span>]</span></span><span class="meta brace round js"><span>)</span></span><span class="punctuation terminator statement js"><span>;</span></span></span></div><div class="line"><span class="source js"><span class="meta brace curly js"><span>}</span></span><span class="meta brace round js"><span>)</span></span><span class="punctuation terminator statement js"><span>;</span></span></span></div></pre>
<blockquote>
<p>Запуск мониторинга <code style="font-family: InconsolataCyr;">gulp watch</code>. При изменениях в любом файле в текущем каталоге с расширением less запускается задача lesscss</p>
<p>В одной задаче watch можно определять несколько шаблонов для мониторинга, либо одной функцией gulp.watch определяя шаблоны в массиве при вызове одной задачи, либо несколько gulp.watch с разными задачами.</p>
<p>Таким образом можно отслеживать файлы разного типа в разных папках и запускать различные задачи</p>
</blockquote>
<h4 id="livereload">Livereload</h4>
<blockquote>
<p>Livereload - расширенная версия мониторинга файлов позволяющая организовать автоматическую перезагрузку страницы в браузере при изменении шаблона, стилей или скриптов</p>
<p>Для организации автоматической перезагрузки нам понадобятся:</p>
</blockquote>
<p><code style="font-family: InconsolataCyr;">sudo npm install connect --save-dev</code></p>
<blockquote>
<p>Connect - фреймворк являющийся прослойкой (middleware) к http серверу для обработки запросов</p>
</blockquote>
<p><code style="font-family: InconsolataCyr;">npm install serve-static --save-dev</code></p>
<blockquote>
<p>Connect middleware для вывода статичных файлов</p>
</blockquote>
<p><code style="font-family: InconsolataCyr;">npm install connect-livereload --save-dev</code></p>
<blockquote>
<p>Connect middleware для добавления скрипта livereload на страницу организовывающий асинхронное обновление стилей и обновление страницы при изменении шаблонов</p>
</blockquote>
<p><code style="font-family: InconsolataCyr;">sudo npm install gulp-livereload --save-dev</code></p>
<blockquote>
<p>Gulp livereload сервер</p>
</blockquote>
<h5 id="-server">Задача server</h5>
<pre class="editor-colors lang-javascript"><div class="line"><span class="source js"><span>gulp</span><span class="meta delimiter method period js"><span>.</span></span><span>task</span><span class="meta brace round js"><span>(</span></span><span class="string quoted single js"><span class="punctuation definition string begin js"><span>'</span></span><span>server</span><span class="punctuation definition string end js"><span>'</span></span></span><span class="meta delimiter object comma js"><span>,</span></span><span>&nbsp;</span><span class="meta function js"><span class="storage type function js"><span>function</span></span><span class="punctuation definition parameters begin js"><span>(</span></span><span class="variable parameter function js"><span>next</span></span><span class="punctuation definition parameters end js"><span>)</span></span></span><span>&nbsp;</span><span class="meta brace curly js"><span>{</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;</span><span class="storage modifier js"><span>var</span></span><span>&nbsp;server&nbsp;</span><span class="keyword operator js"><span>=</span></span><span>&nbsp;</span><span class="support function js"><span>require</span></span><span class="meta brace round js"><span>(</span></span><span class="string quoted single js"><span class="punctuation definition string begin js"><span>'</span></span><span>connect</span><span class="punctuation definition string end js"><span>'</span></span></span><span class="meta brace round js"><span>)</span><span>(</span><span>)</span></span><span class="meta delimiter object comma js"><span>,</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;servestatic&nbsp;</span><span class="keyword operator js"><span>=</span></span><span>&nbsp;</span><span class="support function js"><span>require</span></span><span class="meta brace round js"><span>(</span></span><span class="string quoted single js"><span class="punctuation definition string begin js"><span>'</span></span><span>serve-static</span><span class="punctuation definition string end js"><span>'</span></span></span><span class="meta brace round js"><span>)</span></span><span class="punctuation terminator statement js"><span>;</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;</span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;server</span><span class="meta delimiter method period js"><span>.</span></span><span>use</span><span class="meta brace round js"><span>(</span></span><span class="support function js"><span>require</span></span><span class="meta brace round js"><span>(</span></span><span class="string quoted single js"><span class="punctuation definition string begin js"><span>'</span></span><span>connect-livereload</span><span class="punctuation definition string end js"><span>'</span></span></span><span class="meta brace round js"><span>)</span><span>(</span></span><span class="meta brace curly js"><span>{</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;port</span><span class="keyword operator js"><span>:</span></span><span>&nbsp;</span><span class="constant numeric js"><span>35729</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;</span><span class="meta brace curly js"><span>}</span></span><span class="meta brace round js"><span>)</span><span>)</span></span><span class="punctuation terminator statement js"><span>;</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;</span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;server</span><span class="meta delimiter method period js"><span>.</span></span><span>use</span><span class="meta brace round js"><span>(</span></span><span>servestatic</span><span class="meta brace round js"><span>(</span></span><span class="string quoted single js"><span class="punctuation definition string begin js"><span>'</span></span><span>./app</span><span class="punctuation definition string end js"><span>'</span></span></span><span class="meta delimiter object comma js"><span>,</span></span><span>&nbsp;</span><span class="meta brace curly js"><span>{</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="string quoted single js"><span class="punctuation definition string begin js"><span>'</span></span><span>index</span><span class="punctuation definition string end js"><span>'</span></span></span><span class="keyword operator js"><span>:</span></span><span>&nbsp;</span><span class="meta brace square js"><span>[</span></span><span class="string quoted single js"><span class="punctuation definition string begin js"><span>'</span></span><span>index.html</span><span class="punctuation definition string end js"><span>'</span></span></span><span class="meta delimiter object comma js"><span>,</span></span><span>&nbsp;</span><span class="string quoted single js"><span class="punctuation definition string begin js"><span>'</span></span><span>index.htm</span><span class="punctuation definition string end js"><span>'</span></span></span><span class="meta brace square js"><span>]</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;</span><span class="meta brace curly js"><span>}</span></span><span class="meta brace round js"><span>)</span><span>)</span></span><span class="punctuation terminator statement js"><span>;</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;</span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;server</span><span class="meta delimiter method period js"><span>.</span></span><span>listen</span><span class="meta brace round js"><span>(</span></span><span class="constant numeric js"><span>3000</span></span><span class="meta delimiter object comma js"><span>,</span></span><span>&nbsp;next</span><span class="meta brace round js"><span>)</span></span><span class="punctuation terminator statement js"><span>;</span></span></span></div><div class="line"><span class="source js"><span class="meta brace curly js"><span>}</span></span><span class="meta brace round js"><span>)</span></span><span class="punctuation terminator statement js"><span>;</span></span></span></div></pre>
<blockquote>
<p>servestatic обеспечивает доступ к статичным файлам в каталоге app, а server.listen прослушивание порта 3000 по адресу <a href="http://127.0.0.1">http://127.0.0.1</a></p>
</blockquote>
<h5 id="-watch">Задача watch</h5>
<pre class="editor-colors lang-javascript"><div class="line"><span class="source js"><span>gulp</span><span class="meta delimiter method period js"><span>.</span></span><span>task</span><span class="meta brace round js"><span>(</span></span><span class="string quoted single js"><span class="punctuation definition string begin js"><span>'</span></span><span>watch</span><span class="punctuation definition string end js"><span>'</span></span></span><span class="meta delimiter object comma js"><span>,</span></span><span>&nbsp;</span><span class="meta brace square js"><span>[</span></span><span class="string quoted single js"><span class="punctuation definition string begin js"><span>'</span></span><span>server</span><span class="punctuation definition string end js"><span>'</span></span></span><span class="meta brace square js"><span>]</span></span><span class="meta delimiter object comma js"><span>,</span></span><span>&nbsp;</span><span class="meta function js"><span class="storage type function js"><span>function</span></span><span class="punctuation definition parameters begin js"><span>(</span></span><span class="punctuation definition parameters end js"><span>)</span></span></span><span>&nbsp;</span><span class="meta brace curly js"><span>{</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;</span><span class="storage modifier js"><span>var</span></span><span>&nbsp;liveserver&nbsp;</span><span class="keyword operator js"><span>=</span></span><span>&nbsp;plugins</span><span class="meta delimiter method period js"><span>.</span></span><span>livereload</span><span class="meta brace round js"><span>(</span><span>)</span></span><span class="punctuation terminator statement js"><span>;</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;</span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;gulp</span><span class="meta delimiter method period js"><span>.</span></span><span class="support function js"><span>watch</span></span><span class="meta brace round js"><span>(</span></span><span class="meta brace square js"><span>[</span></span><span class="string quoted single js"><span class="punctuation definition string begin js"><span>'</span></span><span>*.less</span><span class="punctuation definition string end js"><span>'</span></span></span><span class="meta brace square js"><span>]</span></span><span class="meta delimiter object comma js"><span>,</span></span><span>&nbsp;</span><span class="meta brace square js"><span>[</span></span><span class="string quoted single js"><span class="punctuation definition string begin js"><span>'</span></span><span>lesscss</span><span class="punctuation definition string end js"><span>'</span></span></span><span class="meta brace square js"><span>]</span></span><span class="meta brace round js"><span>)</span></span><span class="punctuation terminator statement js"><span>;</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;</span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;gulp</span><span class="meta delimiter method period js"><span>.</span></span><span class="support function js"><span>watch</span></span><span class="meta brace round js"><span>(</span></span><span class="meta brace square js"><span>[</span></span><span class="string quoted single js"><span class="punctuation definition string begin js"><span>'</span></span><span>./app/styles/*.css</span><span class="punctuation definition string end js"><span>'</span></span></span><span class="meta brace square js"><span>]</span></span><span class="meta brace round js"><span>)</span></span><span class="meta delimiter method period js"><span>.</span></span><span>on</span><span class="meta brace round js"><span>(</span></span><span class="string quoted single js"><span class="punctuation definition string begin js"><span>'</span></span><span>change</span><span class="punctuation definition string end js"><span>'</span></span></span><span class="meta delimiter object comma js"><span>,</span></span><span>&nbsp;</span><span class="meta function js"><span class="storage type function js"><span>function</span></span><span class="punctuation definition parameters begin js"><span>(</span></span><span class="variable parameter function js"><span>file</span></span><span class="punctuation definition parameters end js"><span>)</span></span></span><span>&nbsp;</span><span class="meta brace curly js"><span>{</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;liveserver</span><span class="meta delimiter method period js"><span>.</span></span><span>changed</span><span class="meta brace round js"><span>(</span></span><span>file</span><span class="meta delimiter method period js"><span>.</span></span><span>path</span><span class="meta brace round js"><span>)</span></span><span class="punctuation terminator statement js"><span>;</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;</span><span class="meta brace curly js"><span>}</span></span><span class="meta brace round js"><span>)</span></span><span class="punctuation terminator statement js"><span>;</span></span></span></div><div class="line"><span class="source js"><span class="meta brace curly js"><span>}</span></span><span class="meta brace round js"><span>)</span></span><span class="punctuation terminator statement js"><span>;</span></span></span></div></pre>
<blockquote>
<p>За изменениями в файлах следит gulp.watch. При вызове watch запускается задача server и запускается мониторинг по шаблонам.</p>
<p>В примере первый мониторинг за less файлами вызывает задачу lesscss, при этом происходит компиляция less в css в каталоге ./app/styles/, который отслеживается вторым мониторингом и вызывает событие liveserver.changed с передачей имени изменённого файла. Livereload, при получении события changed отправляет имя файла браузеру и тот перерисовывает стили на странице</p>
</blockquote>
<h4 id="jade">Jade</h4>
<hr>